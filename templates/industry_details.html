{% extends "index.html" %}

{% block content %}

<a href="{{ url_for('Industries') }}" class="btn mt-3"
    style="background-color: transparent; color: black; text-decoration: none; border: none; box-shadow: none;"
    onmouseover="this.style.color='gray'" onmouseout="this.style.color='black'">
    Back to Industries
</a>

<!-- Buttons for other industries -->
<br>
<div class="industry-buttons mb-4">
    {% for other_industry in other_industries %}
        {% if other_industry != current_industry %}  <!-- Exclude the current industry -->
        <form action="{{ url_for('industry_details') }}" method="POST" style="display:inline;">
            <input type="hidden" name="industry_name" value="{{ other_industry }}">
            <button type="submit">{{ other_industry }}</button>
        </form>
        {% endif %}
    {% endfor %}
</div>

<div class="container mt-4">
    <p>More information about the {{ industry }} industry.</p>
</div>

<!-- Data Visualisation -->

<div class="jumbotron" style="height: fit-content;">
    <h1 class="display-1">{{ industry }}</h1>
    <h3>Skills:</h3>
    <br>

    <div class="d-flex flex-wrap">
        {% for skill in skill_list %}
        <div class="border rounded-pill d-inline p-1 m-1" style="background-color: rgb(255, 255, 255); border-color: rgb(255, 168, 61);" >
            {{ skill }}
        </div>
        {% endfor %}
    </div>
    <br>
    <hr class="my-4">
    <br>
    <div id="bubble-chart" style="flex-grow: 1; height:600px;">
        {{ job_title_chart|safe }}
    </div>
    <br>
    <br>
    <div id="salary-trend-chart">
        {{ salary_trend_chart|safe }}
    </div>
    <br>
    <div>
        {{ salary_chart|safe }}
    </div>
    <br>
    <div id="salary-growth-chart">
        {{ salary_growth_chart | safe }}
    </div>
    <br>
    <div>
        {{ job_trend_fig | safe }}
    </div>
    <br>
    <div>
        {{wordCloud | safe}}
    </div>
    <br>
    <div>
        {{ hiring_trend_fig | safe }}
    </div>

</div>
<br>
</div>


<div class="container card text-black border-dark" style="background-color: rgb(255, 218, 53)">
    <!--text boxes-->
    <div class="row card-body" style="background-color: rgb(255, 218, 53)">
        <div class="card-title col-sm-10">
            <h3>Discover your suitable role now!</h3>
            <p>Find out more about your career</p>

        </div>
        <div class="col-sm-2 d-flex justify-content-center align-items-center" >
            <a class="btn btn-primary p-3" style="border-radius: 35px;" href="{{ url_for('Resume') }}">Find Now</a>

        </div>
    </div>
</div>
<button onclick="scrollToTop()" id="scrollTopBtn" title="Go to top">⬆️</button>




<!-- JavaScript to Handle Click Events and Interaction Between Charts -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const bubbleChartFrame = document.querySelector(
            '#bubble-chart .plotly-graph-div'); // Selecting the bubble chart div
        const salaryTrendChartFrame = document.querySelector(
            '#salary-trend-chart .plotly-graph-div'); // Selecting the salary trend chart div
        // const salaryGrowthChartFrame = document.querySelector(
        //     '#salary-growth-chart .plotly-graph-div'); // Selecting the salary growth chart div

        // Ensure the charts are loaded properly
        if (bubbleChartFrame && salaryTrendChartFrame){ //&& salaryGrowthChartFrame) {
            // Listen for a click event on the bubble chart
            bubbleChartFrame.on('plotly_click', function (data) {
                const clickedJobTitle = data.points[0].text; // Get the clicked job title
                console.log("Clicked Job Title:", clickedJobTitle);

                // Show the salary line and trendline for the clicked job title in the salary trend chart
                const salaryTrendTraces = salaryTrendChartFrame.data;
                for (let i = 0; i < salaryTrendTraces.length; i++) {
                    // Show only the salary line and trendline for the clicked job title
                    if (salaryTrendTraces[i].name.includes(clickedJobTitle)) {
                        Plotly.restyle(salaryTrendChartFrame, {
                            visible: true
                        }, [i]);
                    } else {
                        Plotly.restyle(salaryTrendChartFrame, {
                            visible: 'legendonly'
                        }, [i]);
                    }
                }

                // Show the salary growth line and prediction for the clicked job title in the salary growth chart
                // const salaryGrowthTraces = salaryGrowthChartFrame.data;
                // for (let i = 0; i < salaryGrowthTraces.length; i++) {
                //     // Show only the salary growth and prediction lines for the clicked job title
                //     if (salaryGrowthTraces[i].name.includes(clickedJobTitle)) {
                //         Plotly.restyle(salaryGrowthChartFrame, {
                //             visible: true
                //         }, [i]);
                //     } else {
                //         Plotly.restyle(salaryGrowthChartFrame, {
                //             visible: 'legendonly'
                //         }, [i]);
                //     }
                // }
            });
        } else {
            console.error('Bubble chart, salary trend chart, or salary growth chart not found.');
        }
    });

    // Show/Hide the "scroll to top" button when scrolling
    window.onscroll = function() {scrollFunction()};

    function scrollFunction() {
        const scrollTopBtn = document.getElementById("scrollTopBtn");
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            scrollTopBtn.style.display = "block"; // Show the button
        } else {
            scrollTopBtn.style.display = "none"; // Hide the button
        }
    }

    // Scroll to the top when the user clicks the button
    function scrollToTop() {
        document.body.scrollTop = 0; // For Safari
        document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE, and Opera
    }

    async function fetchChartData() {
        const response = await fetch('/get-salary-growth-data');
        const chartData = await response.json();
        Plotly.newPlot('salary-growth-chart', chartData);
    }
    fetchChartData();  // Call this function to load chart asynchronously
</script>



{% endblock %}